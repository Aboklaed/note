<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</title>
    <style>
        body {
    font-family: 'Cairo', sans-serif;
    background-color: #FFE0B2;
    color: #333;
    direction: rtl;
    text-align: center;
    min-height: 100vh;
    margin: 0;
    padding: 0; /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø´ÙˆØ© Ù„ØªÙƒÙˆÙ† ØµÙØ± */
}

.container {
    max-width: 600px;
    padding: 20px;
    background-color: #FFE0B2;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    margin-bottom: 20px;
}

h3 {
    color: #0D4B56;
}

h4 {
    color: #cc2b5e;
}

input[type="text"] {
    width: 95%;
    padding: 10px;
    font-size: 25px;
    margin: 10px 0;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(2, 2, 2, 0.21); /* ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙŠÙ… */
}

.note {
    background-color: #FFF3E0;
    border-radius: 8px;
    padding: 10px;
    text-align: left;
    width: 95%;
    margin: 10px 0; /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ */
    box-shadow: 0 4px 8px rgba(2, 2, 2, 0.21); /* ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙŠÙ… */
}

.buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(2, 2, 2, 0.21); /* ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙŠÙ… */
}

.footer {
    font-size: 18px;
    background-color: #EEEEEF;
    padding: 10px;
    border-radius: 8px;
    margin: 20px 15px 40px; /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ */
    display: flex;
    justify-content: center;
    align-items: center;
    height: 40px;
    color: black;
    box-shadow: 0 4px 8px rgba(2, 2, 2, 0.21); /* ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙŠÙ… */
    border: 1px solid #ccc;
    transition: background-color 0.3s, box-shadow 0.3s;
    cursor: pointer;
}

.footer:hover {
    background-color: #DDDDDE;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}

.footer:active {
    background-color: #CCCCCD;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

table {
    background-color: #FFF3E0;
    width: 100%;
    border-collapse: collapse;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(2, 2, 2, 2.11); /* ØªØµØ­ÙŠØ­ Ø§Ù„Ù‚ÙŠÙ… */
    overflow: hidden;
}

th, td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
    font-size: 18px;
}

th {
    background-color: #f2f2f2;
    font-weight: bold;
}

tr:nth-child(even) {
    background-color: #f9f9f9;
}

tr:hover {
    background-color: #f1f1f1;
    transition: background-color 0.3s;
}
 .qibla-button {
    font-size: 16px;
    cursor: pointer;
    padding: 10px 20px;
    background-color: #EEEEEE;
    color: black;
    border: none;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    width: 100%; /* ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø²Ø± ÙŠÙ…ØªØ¯ Ø¨Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
    max-width: 300px; /* ÙŠØ­Ø¯Ø¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø± */
    min-width: 150px; /* ÙŠØ­Ø¯Ø¯ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø²Ø± */
    border-radius: 10px; /* Ø­ÙˆØ§Ù Ù…Ø³ØªØ¯ÙŠØ±Ø© */
}


    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h3>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø·Ù‚Ø³ ØªÙ„Ù‚Ø§Ø¦ÙŠ</h3>
      
                 <table style="width: 100%; table-layout: fixed;">
                <tr>
                    <td style="width: 50%; text-align: right;">
                        <div class="prayer-times" id="prayer-times"></div>
                    </td>
                    <td style="vertical-align: top; width: 50%; text-align: left;">
                        <div class="weather" id="weather-info"></div>
                    </td>
                </tr>
                </table>
                   <h4>Ø¥Ø¯Ø®Ù„ Ù„ØªØ´Ø§Ù‡Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù„Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© ÙˆØ§Ù„Ø·Ù‚Ø³.ğŸ‘‡</h4>
        <input type="text" id="city" placeholder="Ø¥Ø¯Ø®Ù„ ÙˆØ®Ø° Ù…Ø¹Ù„ÙˆÙ…Ø©" oninput="fetchCityInfo()" onkeypress="hideKeyboard(event)">
        <div class="note">
          
          <div class="container">
        <button class="qibla-button" onclick="openQiblaFinder()">Ø¹Ø±Ø¶ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©ğŸ•‹</button>
    </div>
            <table style="width: 100%; table-layout: fixed;">
                <tr>
                    <td colspan="2" style="text-align: right;">
                        <div class="info" id="city-info"></div>
                        <div class="city-image" id="city-image"></div>
                    </td>
                </tr>
                
            </table>
            <div class="buttons">
                <button onclick="shareCityInfo()">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ©</button>
                <button onclick="speakCityInfo()">ğŸ”Š Ù‚Ø±Ø§Ø¡Ø©</button>
                <button onclick="stopSpeaking()">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù</button>
            </div>
        </div>
    </div>
    <div class="footer">Ø¨Ø±Ù…Ø¬Ø© Ø­Ø³ÙŠÙ† Ø§Ù„Ø¹Ø±ÙŠØ§Ù†ÙŠ</div>
    <script>
  
        document.addEventListener("DOMContentLoaded", function() {
    getLocation();

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø­Ø¯Ø« Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§
    document.getElementById("city").addEventListener("change", function() {
        fetchCityInfo();
    });
});

async function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        console.log("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.");
    }
}

async function showPosition(position) {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
    
    console.log("Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ - Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶: " + latitude + "ØŒ Ø®Ø· Ø§Ù„Ø·ÙˆÙ„: " + longitude);
    
    const city = await getCityFromCoordinates(latitude, longitude);
    document.getElementById('city').value = city;
    
    fetchCityInfo();
}

async function getCityFromCoordinates(latitude, longitude) {
    const reverseGeocodingApiUrl = `https://api.openweathermap.org/geo/1.0/reverse?lat=${latitude}&lon=${longitude}&limit=1&appid=cbc51ce6b403bc63ab3729807141973a&lang=ar`;

    try {
        const response = await fetch(reverseGeocodingApiUrl);

        if (!response.ok) {
            throw new Error('Error fetching city data');
        }

        const data = await response.json();
        let city = data[0].name;
        
        // Ø¥Ø²Ø§Ù„Ø© "Governorate of" Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
        city = city.replace('Governorate of ', '');

        // ØªØµØ­ÙŠØ­ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©
        if (city === "Jidda") {
            city = "Jeddah";
        }

        return city;
    } catch (error) {
        console.error('Error:', error);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
    }
}

async function showError(error) {
    let errorMessage = '';
    switch(error.code) {
        case error.PERMISSION_DENIED:
            errorMessage = "ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.";
            break;
        case error.POSITION_UNAVAILABLE:
            errorMessage = "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©.";
            break;
        case error.TIMEOUT:
            errorMessage = "Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø·Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹.";
            break;
        case error.UNKNOWN_ERROR:
            errorMessage = "Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ.";
            break;
    }
    alert(errorMessage);
    document.getElementById("city").style.display = "block";
}

function fetchCityInfo() {
    const city = document.getElementById("city").value;
    if (city) {
        fetchCityDetails(city);
        fetchWeatherInfo(city);
        fetchPrayerTimes(city);
        fetchCityImage(city);
    }
}

function fetchCityDetails(city) {
    const apiUrl = `https://ar.wikipedia.org/api/rest_v1/page/summary/${city}`;
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            const cityInfo = `
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†:</h3>
                <p><a href="https://www.google.com/maps/search/?api=1&query=${city}" target="_blank">${city}</a></p>
                <p>${data.extract}</p>
            `;
            document.getElementById("city-info").innerHTML = cityInfo;
        })
        .catch(error => console.error('Error fetching city details:', error));
}

function fetchWeatherInfo(city) {
    const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=cbc51ce6b403bc63ab3729807141973a&units=metric&lang=ar`;
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            const weatherInfo = `
                <h3></h3>
                <p>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©: ${data.main.temp}Â°C</p>
                <p>Ø§Ù„Ø±Ø·ÙˆØ¨Ø©: ${data.main.humidity}%</p>
                <p>Ø§Ù„Ø·Ù‚Ø³: ${data.weather[0].description}</p>
            `;
            document.getElementById("weather-info").innerHTML = weatherInfo;
        })
        .catch(error => console.error('Error fetching weather info:', error));
}

function fetchPrayerTimes(city) {
    const apiUrl = `https://api.aladhan.com/v1/timingsByCity?city=${city}&country=Saudi%20Arabia&method=4`;
    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            const prayerTimes = data.data.timings;
            const prayerTimesInfo = `
                <h3></h3>
                <p>Ø§Ù„ÙØ¬Ø±: ${prayerTimes.Fajr}</p>
                <p>Ø§Ù„Ø¸Ù‡Ø±: ${prayerTimes.Dhuhr}</p>
                <p>Ø§Ù„Ø¹ØµØ±: ${prayerTimes.Asr}</p>
                <p>Ø§Ù„Ù…ØºØ±Ø¨: ${prayerTimes.Maghrib}</p>
                <p>Ø§Ù„Ø¹Ø´Ø§Ø¡: ${prayerTimes.Isha}</p>
            `;
            document.getElementById("prayer-times").innerHTML = prayerTimesInfo;
        })
        .catch(error => console.error('Error fetching prayer times:', error));
}

function fetchCityImage() {
    const city = document.getElementById('city').value;
    if (city.trim() !== "") {
        const lang = /[\u0600-\u06FF]/.test(city) ? 'ar' : 'en';
        const apiUrl = `https://${lang}.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(city)}&prop=pageimages&format=json&pithumbsize=500&origin=*`;
        fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const pages = data.query.pages;
                const pageId = Object.keys(pages)[0];
                const imageUrl = pages[pageId].thumbnail ? pages[pageId].thumbnail.source : null;
                const imageContainer = document.getElementById('city-image');
                if (imageUrl) {
                    const img = new Image();
                    img.src = imageUrl;
                    img.style.width = "100%";
                    img.style.borderRadius = "8px";
                    imageContainer.innerHTML = '';
                    imageContainer.appendChild(img);
                } else {
                    imageContainer.innerHTML = 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØµÙˆØ±Ø©';
                }
            })
            .catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:', error);
                document.getElementById('city-image').innerHTML = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø©';
            });
    } else {
        alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©");
    }
}
  
function hideKeyboard(event) {
    if (event.key === "Enter") {
        document.activeElement.blur();
    }
}

function shareCityInfo() {
    const cityInfo = document.getElementById("city-info").innerText;
    const weatherInfo = document.getElementById("weather-info").innerText;
    const prayerTimes = document.getElementById("prayer-times").innerText;
    const shareData = {
        title: 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
        text: `${cityInfo}\n${weatherInfo}\n${prayerTimes}`,
        url: window.location.href
    };
    navigator.share(shareData).catch(console.error);
}

function speakCityInfo() {
    const cityInfo = document.getElementById("city-info").innerText;
    const weatherInfo = document.getElementById("weather-info").innerText;
    const prayerTimes = document.getElementById("prayer-times").innerText;
    const utterance = new SpeechSynthesisUtterance(`${cityInfo}\n${weatherInfo}\n${prayerTimes}`);
    utterance.lang = 'ar-SA';
    speechSynthesis.speak(utterance);
}

function stopSpeaking() {
    speechSynthesis.cancel();
}
  function openQiblaFinder() {
            window.open('https://qiblafinder.withgoogle.com/intl/ar', 'Qibla Finder', 'width=800,height=600');
        }
                     
    </script>
</body>
</html>
