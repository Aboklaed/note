<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>باحث اليوتيوب</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>باحث اليوتيوب<span>برمجة حسين العرياني</span></h1>
    <div class="search-box">
      <input type="text" class="search-bar" id="inputBox" placeholder="ابحث عن مقاطع الفيديو على YouTube">
      <button class="search-btn" onclick="search()">🔎</button>
    </div>
    <div id="player-container">
      <div id="player"></div>
    </div>
    <div id="videosResults"></div>
  </div>

  <!-- تضمين مكتبة YouTube Player API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // JavaScript للبحث عن نتائج YouTube بشكل عام بدون استخدام API

    // تعريف متغير عالمي للمشغل
    let player;

    // دالة لبدء تشغيل الفيديو في المشغل المضمن
    function playVideo(videoId) {
      if (player) {
        player.loadVideoById(videoId);
      } else {
        player = new YT.Player('player', {
          height: '180', // انخفاض ارتفاع المشغل ليكون أصغر
          width: '320', // انخفاض عرض المشغل ليكون أصغر
          videoId: videoId,
          events: {
            'onReady': onPlayerReady
          }
        });
      }
      // الانتقال إلى أعلى الصفحة لرؤية الفيديو
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // دالة تشغيل الفيديو عندما يكون المشغل جاهزًا
    function onPlayerReady(event) {
      event.target.playVideo();
    }

    // دالة البحث عن الفيديوهات على YouTube
    async function search() {
      try {
        const input = document.getElementById('inputBox').value.trim();
        if (input === '') {
          alert('يرجى إدخال مصطلح بحث صالح.');
          return;
        }

        const apiKey = 'AIzaSyA266SPutTfCO63sLArqnx8Xi-UR51PSus'; // استبدال بمفتاح الواجهة البرمجية للتطبيق الخاص بك

        const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(input)}&maxResults=25&key=${apiKey}`);
        const data = await response.json();

        const videosResults = document.getElementById('videosResults');
        videosResults.innerHTML = '';

        data.items.forEach(item => {
          if (item.id.kind === 'youtube#video') {
            const videoId = item.id.videoId;
            const title = item.snippet.title;
            const channelTitle = item.snippet.channelTitle;
            const thumbnailUrl = item.snippet.thumbnails.medium.url;

            const videoItem = document.createElement('div');
            videoItem.classList.add('video-item');

            const thumbnailImg = document.createElement('img');
            thumbnailImg.classList.add('video-thumbnail');
            thumbnailImg.src = thumbnailUrl;
            thumbnailImg.alt = title;
            // جعل الصورة تبدأ الفيديو عند النقر
            thumbnailImg.addEventListener('click', function() {
              playVideo(videoId);
            });

            // استخدام <span> بدلاً من <a> لعرض العنوان
            const titleElem = document.createElement('span');
            titleElem.classList.add('video-title');
            titleElem.textContent = title;
            titleElem.addEventListener('click', function() {
              playVideo(videoId);
            });

            const channelElem = document.createElement('p');
            channelElem.classList.add('channel-name');
            channelElem.textContent = channelTitle;

            const downloadBtn = document.createElement('a');
            downloadBtn.classList.add('download-button');
            downloadBtn.textContent = 'تحميل الفيديو';
            const downloadUrl = `https://www.ssyoutube.com/watch?v=${videoId}`;
            downloadBtn.href = downloadUrl;
            downloadBtn.addEventListener('click', function(event) {
              event.preventDefault();
              navigator.clipboard.writeText(downloadUrl).then(function() {
                window.location.href = downloadUrl;
              }, function(err) {
                console.error('فشل في نسخ الرابط:', err);
              });
            });

            // جعل العنصر بأكمله يبدأ الفيديو عند النقر
            videoItem.addEventListener('click', function() {
              playVideo(videoId);
            });

            videoItem.appendChild(thumbnailImg);
            videoItem.appendChild(titleElem); // استخدام <span> بدلاً من <a>
            videoItem.appendChild(channelElem);
            videoItem.appendChild(downloadBtn);

            videosResults.appendChild(videoItem);
          }
        });
      } catch (error) {
        console.error('حدث خطأ أثناء جلب البيانات:', error);
        alert('حدث خطأ أثناء جلب البيانات. يرجى المحاولة مرة أخرى لاحقًا.');
      }
    }

    // إضافة حدث keydown للبحث عند الضغط على Enter
    document.getElementById('inputBox').addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        search();
        event.target.blur(); // إخفاء لوحة المفاتيح بعد البحث
      }
    });

  </script>
</body>
</html>
